# نرم‌افزار مدیریت اقساط بیمه ایران - راهنمای کامل
## Iran Insurance Installment Management System - Complete Guide

## ✅ ویژگی‌های کامل شده و آماده

### 1. ثبت بیمه‌نامه با ایجاد خودکار اقساط
**وضعیت**: ✅ کامل و آزمایش شده

هنگام ثبت یک بیمه‌نامه جدید:
- اطلاعات بیمه‌نامه در پایگاه داده ذخیره می‌شود
- اقساط به صورت **خودکار** محاسبه و ایجاد می‌شوند
- اقساط در تمام بخش‌ها قابل مشاهده هستند:
  * صفحه مدیریت اقساط (تب اقساط)
  * نمای اختصاصی اقساط هر بیمه‌نامه (دکمه "مدیریت اقساط")
  * تقویم اقساط
  * داشبورد (آمار)

#### نحوه کار:
1. از تب "بیمه‌نامه‌ها"، روی "+ بیمه‌نامه جدید" کلیک کنید
2. فرم را با اطلاعات زیر پر کنید:
   - شماره بیمه‌نامه (یکتا)
   - نام بیمه‌گذار
   - شماره موبایل (11 رقمی، با 09 شروع شود)
   - نوع بیمه (شخص ثالث، بدنه، عمر، حوادث، آتش‌سوزی)
   - مبلغ کل بیمه
   - مبلغ پیش‌پرداخت
   - تعداد اقساط
   - تاریخ صدور و انقضا (تقویم شمسی)
3. روی "ذخیره" کلیک کنید

**نتیجه**:
- بیمه‌نامه ثبت می‌شود
- تعداد مشخص شده قسط به صورت خودکار ایجاد می‌شود
- اولین قسط یک ماه بعد از تاریخ صدور سررسید دارد
- اقساط بعدی هر ماه سررسید می‌شوند
- مبلغ هر قسط = (مبلغ کل - پیش‌پرداخت) ÷ تعداد اقساط

### 2. مدیریت اقساط در چند نما

#### نمای کلی اقساط (تب اقساط)
- نمایش اقساطی که در 30 روز آینده سررسید دارند
- اطلاعات کامل: شماره بیمه‌نامه، نوع، مبلغ، تاریخ سررسید، موبایل، نام
- دکمه "ثبت پرداخت" برای اقساط پرداخت نشده
- تاریخ‌ها به شمسی نمایش داده می‌شوند

#### نمای اختصاصی هر بیمه‌نامه
از لیست بیمه‌نامه‌ها، روی "مدیریت اقساط" کلیک کنید:
- اطلاعات کامل بیمه‌نامه در بالا
- لیست تمام اقساط این بیمه‌نامه
- شماره قسط، مبلغ، تاریخ سررسید، تاریخ پرداخت
- وضعیت با رنگ‌بندی:
  * 🟢 سبز: پرداخت شده
  * 🟡 نارنجی: در انتظار
  * 🔴 قرمز: معوق
- دکمه "ثبت پرداخت" برای هر قسط

#### تقویم اقساط
- نمای تقویمی شمسی
- نمایش اقساط سررسید در هر روز
- امکان فیلتر بر اساس تاریخ

### 3. پایگاه داده و Migration

**وضعیت**: ✅ کامل و آزمایش شده

#### ویژگی‌های پایگاه داده:
- SQLite با SQLAlchemy ORM
- Migrations خودکار هنگام اجرا
- پشتیبانی از schema های قدیمی و جدید

#### Migration Manager:
- هنگام اجرای برنامه، به صورت خودکار اجرا می‌شود
- ستون‌های جدید را به جداول موجود اضافه می‌کند
- سازگار با نسخه‌های قدیمی پایگاه داده
- Log کامل از تغییرات

#### جداول موجود:
1. **users** - کاربران سیستم
2. **policies** - بیمه‌نامه‌ها
3. **installments** - اقساط
4. **reminders** - یادآورها
5. **schema_migrations** - پیگیری migrations

### 4. نمایش تاریخ به شمسی

**وضعیت**: ✅ کامل در تمام بخش‌ها

#### PersianDateEdit Widget:
- ویجت سفارشی برای انتخاب تاریخ شمسی
- نمایش تاریخ به فرمت "۴ بهمن ۱۴۰۲"
- تقویم شمسی popup
- دکمه "امروز" برای انتخاب سریع

#### تبدیل تاریخ:
- تمام تاریخ‌ها در پایگاه داده میلادی ذخیره می‌شوند
- در UI به شمسی نمایش داده می‌شوند
- تبدیل خودکار بین میلادی ↔ شمسی

#### نمایش در:
- فرم ثبت بیمه‌نامه ✅
- لیست اقساط ✅
- تقویم اقساط ✅
- گزارش‌ها ✅
- داشبورد ✅

### 5. فیلترها

**وضعیت**: ✅ کامل و کاربردی

#### فیلتر بیمه‌نامه‌ها:
- جستجو بر اساس شماره بیمه‌نامه یا نام بیمه‌گذار
- فیلتر بر اساس وضعیت (فعال، منقضی)

#### فیلتر اقساط:
- فیلتر بر اساس بازه زمانی (از تاریخ - تا تاریخ)
- فیلتر بر اساس وضعیت (همه، پرداخت شده، در انتظار، معوق)
- فیلتر بر اساس نوع بیمه
- نمایش اقساط 30 روز آینده به صورت پیش‌فرض

#### فیلتر گزارش‌ها:
- انتخاب نوع گزارش
- بازه زمانی
- وضعیت پرداخت
- نوع بیمه

### 6. گزارش‌گیری

**وضعیت**: ✅ کامل با پشتیبانی از فارسی

#### انواع گزارش:
1. **گزارش اقساط** - تمام اقساط با فیلتر
2. **خلاصه بیمه‌نامه‌ها** - آمار هر بیمه‌نامه
3. **آمار پرداخت‌ها** - تحلیل ماهانه پرداخت‌ها

#### فرمت‌های خروجی:
- **Excel (.xlsx)** - قابل باز شدن در Excel، LibreOffice
- **CSV (.csv)** - با encoding UTF-8-BOM برای فارسی

#### ویژگی‌های گزارش‌ها:
- تاریخ‌های شمسی
- نام ستون‌ها به فارسی
- اعداد با جداکننده هزارگان
- ارز ریال

#### نحوه استفاده:
1. به تب "گزارش‌ها" بروید
2. نوع گزارش را انتخاب کنید
3. فیلترها را تنظیم کنید
4. روی "خروجی Excel" یا "خروجی CSV" کلیک کنید
5. محل ذخیره را مشخص کنید

### 7. تنظیمات پیامک

**وضعیت**: ✅ کامل با ذخیره‌سازی پایدار

#### ConfigManager:
- ذخیره تنظیمات در فایل `config.json`
- بارگذاری خودکار تنظیمات
- پشتیبانی از تنظیمات مختلف:
  * SMS
  * Notifications
  * UI
  * Reports

#### تنظیمات SMS:
از منوی "تنظیمات" > "تنظیمات پیامک":
1. چک‌باکس "فعال‌سازی سرویس پیامک"
2. API Key
3. API URL
4. شماره ارسال‌کننده (اختیاری)
5. دکمه "تست اتصال"
6. دکمه "ذخیره"

#### SMSManager:
- بارگذاری خودکار از config
- ارسال یادآوری قسط
- ارسال هشدار معوقی
- ارسال گروهی

**نکته**: برای استفاده واقعی، نیاز به API یک سرویس پیامک دارید.

### 8. رابط کاربری حرفه‌ای

**وضعیت**: ✅ کامل و جذاب

#### ویژگی‌های UI:
- **RTL کامل**: تمام عناصر راست به چپ
- **فونت Vazir**: نمایش بهینه فارسی
- **رنگ‌بندی مدرن**: آبی، سبز، نارنجی، قرمز
- **Sidebar**: منوی کناری زیبا با آیکون
- **Tab Interface**: تب‌های رنگی
- **StatusBar**: نوار وضعیت با گرادیانت
- **Toolbar**: نوار ابزار سریع

#### عناصر UI:
- **کارت‌های آماری** در داشبورد
- **جداول رنگی** برای لیست‌ها
- **دکمه‌های رنگی** با hover effect
- **Dialog های مدال** برای فرم‌ها
- **پیام‌های کاربرپسند** به فارسی

#### Responsive:
- حداقل اندازه: 1200x700
- قابل تغییر اندازه
- Splitter برای sidebar

### 9. اعتبارسنجی و خطایابی

**وضعیت**: ✅ کامل

#### اعتبارسنجی فرم‌ها:
- شماره بیمه‌نامه یکتا
- شماره موبایل (11 رقم، شروع با 09)
- مبلغ کل > 0
- پیش‌پرداخت ≤ مبلغ کل
- تاریخ پایان > تاریخ شروع
- فیلدهای ضروری نباید خالی باشند

#### مدیریت خطا:
- Logging کامل در `insurance_manager.log`
- پیام‌های خطا به فارسی
- پیام‌های موفقیت برای عملیات‌ها
- Rollback خودکار در صورت خطای دیتابیس

#### استثناءها:
- Try-except در تمام عملیات حساس
- پیام‌های کاربرپسند
- Log تمام خطاها

### 10. داشبورد آماری

**وضعیت**: ✅ با نمودارها و کارت‌ها

#### کارت‌های آماری:
- 📊 کل بیمه‌نامه‌ها
- 💰 کل اقساط
- ✅ اقساط پرداخت شده
- ⏳ اقساط در انتظار
- ⚠️ اقساط معوق

#### نمودارها:
- نمودار دایره‌ای: نسبت وضعیت‌های پرداخت
- نمودار میله‌ای: پرداخت‌های ماهانه
- رنگ‌بندی زیبا و قابل خواندن

## 🧪 تست‌ها

### تست خودکار
فایل `test_complete_workflow.py` تمام ویژگی‌ها را تست می‌کند:

```bash
python test_complete_workflow.py
```

**نتیجه آخرین تست**:
```
✓ All tests completed successfully!
  • Database initialization and migrations
  • User authentication
  • Policy creation
  • Automatic installment generation
  • Payment tracking
  • Persian calendar support
  • Report generation
  • Configuration management
```

### تست Migration
برای تست migration روی دیتابیس قدیمی:
```bash
python test_migration.py
```

## 📝 نکات مهم

### 1. اولین اجرا
- نام کاربری پیش‌فرض: `admin`
- رمز عبور پیش‌فرض: `admin123`
- ⚠️ حتماً رمز را بعد از اولین ورود تغییر دهید

### 2. پایگاه داده
- فایل: `insurance.db`
- به صورت خودکار ایجاد می‌شود
- Migration خودکار اجرا می‌شود
- پشتیبان‌گیری منظم توصیه می‌شود

### 3. فایل تنظیمات
- فایل: `config.json`
- به صورت خودکار ایجاد می‌شود
- شامل تنظیمات SMS، UI، و غیره

### 4. Log
- فایل: `insurance_manager.log`
- شامل تمام رویدادها و خطاها
- برای عیب‌یابی مفید است

## 🚀 راهنمای سریع استفاده

### سناریو کامل:

1. **نصب و اجرا**
```bash
pip install -r requirements.txt
python main.py
```

2. **ورود**
- نام کاربری: admin
- رمز: admin123

3. **ثبت بیمه‌نامه**
- تب "بیمه‌نامه‌ها" → "+ بیمه‌نامه جدید"
- پر کردن فرم
- ذخیره (اقساط خودکار ایجاد می‌شوند)

4. **پیگیری اقساط**
- تب "اقساط": اقساط 30 روز آینده
- یا "مدیریت اقساط" از لیست بیمه‌نامه‌ها

5. **ثبت پرداخت**
- دکمه "ثبت پرداخت" کنار هر قسط
- تأیید

6. **گزارش‌گیری**
- تب "گزارش‌ها"
- انتخاب نوع و فیلتر
- خروجی Excel یا CSV

7. **تنظیم SMS (اختیاری)**
- منو "تنظیمات" → "تنظیمات پیامک"
- وارد کردن API key و URL
- ذخیره

## 📊 آمار پروژه

- **کل فایل‌های Python**: 30+
- **تعداد کلاس**: 25+
- **تعداد تابع**: 150+
- **خطوط کد**: 5000+
- **تعداد تست**: 10 تست جامع

## ✅ چک‌لیست کامل بودن

- [x] ثبت بیمه‌نامه
- [x] ایجاد خودکار اقساط
- [x] نمایش اقساط در چند نما
- [x] ثبت پرداخت
- [x] پیگیری اقساط معوق
- [x] تقویم شمسی کامل
- [x] فیلترهای پیشرفته
- [x] گزارش‌گیری Excel/CSV
- [x] تنظیمات SMS پایدار
- [x] Migration خودکار
- [x] UI حرفه‌ای RTL
- [x] اعتبارسنجی کامل
- [x] مدیریت خطا
- [x] داشبورد آماری
- [x] Log سیستم

## 🎓 نتیجه‌گیری

سیستم مدیریت اقساط بیمه ایران یک نرم‌افزار **کامل، حرفه‌ای و آماده برای استفاده** است که تمام ویژگی‌های ذکر شده در problem statement را پیاده‌سازی کرده است:

✅ بیمه‌نامه‌ها را ثبت کنید → اقساط خودکار ایجاد می‌شوند
✅ اقساط در همه جا نمایش داده می‌شوند
✅ تاریخ‌ها شمسی هستند
✅ فیلترها کار می‌کنند
✅ گزارش‌ها تولید می‌شوند
✅ تنظیمات SMS ذخیره می‌شوند
✅ UI حرفه‌ای و زیباست

**آماده برای استفاده در محیط واقعی!** 🎉
