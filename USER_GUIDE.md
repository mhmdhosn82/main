# راهنمای استفاده از سیستم مدیریت اقساط بیمه ایران
# Iran Insurance Installment Management System - User Guide

## فهرست مطالب / Table of Contents

1. [نصب و راه‌اندازی](#installation)
2. [ورود به سیستم](#login)
3. [داشبورد](#dashboard)
4. [مدیریت بیمه‌نامه‌ها](#policies)
5. [مدیریت اقساط](#installments)
6. [تقویم اقساط](#calendar)
7. [گزارش‌گیری](#reports)
8. [سیستم پیامک](#sms)
9. [تنظیمات](#settings)
10. [رفع مشکلات](#troubleshooting)

---

## 1. نصب و راه‌اندازی {#installation}

### پیش‌نیازها
- Python 3.8 یا بالاتر
- pip (مدیر بسته‌های Python)
- حداقل 4GB RAM
- 200MB فضای خالی دیسک

### مراحل نصب

#### روش اول: استفاده از اسکریپت نصب خودکار (توصیه می‌شود)

```bash
# 1. دانلود یا کلون کردن مخزن
git clone https://github.com/mhmdhosn82/main.git
cd main

# 2. اجرای اسکریپت نصب
python setup.py
```

اسکریپت نصب به طور خودکار:
- وابستگی‌ها را نصب می‌کند
- دیتابیس را راه‌اندازی می‌کند
- کاربر پیش‌فرض admin ایجاد می‌کند
- تست‌های اولیه را اجرا می‌کند

#### روش دوم: نصب دستی

```bash
# 1. نصب وابستگی‌ها
pip install -r requirements.txt

# 2. اجرای برنامه (دیتابیس به طور خودکار ایجاد می‌شود)
python main.py
```

### اجرای برنامه

پس از نصب موفق، برای اجرای برنامه:

```bash
python main.py
```

---

## 2. ورود به سیستم {#login}

### ورود اولیه

در اولین اجرا، از اطلاعات پیش‌فرض استفاده کنید:

- **نام کاربری**: `admin`
- **رمز عبور**: `admin123`

⚠️ **نکته امنیتی**: حتماً پس از اولین ورود، رمز عبور را تغییر دهید.

### ثبت‌نام کاربر جدید

1. در پنجره ورود، روی دکمه "ثبت‌نام" کلیک کنید
2. فرم ثبت‌نام را پر کنید:
   - نام و نام خانوادگی (الزامی)
   - نام کاربری (الزامی)
   - رمز عبور (الزامی، حداقل 6 کاراکتر)
   - ایمیل (اختیاری)
   - شماره تلفن (اختیاری)
3. روی "ثبت‌نام" کلیک کنید

---

## 3. داشبورد {#dashboard}

داشبورد نمایی جامع از وضعیت سیستم را ارائه می‌دهد.

### کارت‌های آماری

داشبورد شامل 4 کارت آماری است:

1. **تعداد بیمه‌نامه‌ها**: کل بیمه‌نامه‌های ثبت شده
2. **اقساط معوق**: تعداد اقساط سررسید گذشته
3. **پرداخت‌های آتی**: اقساطی که در 30 روز آینده سررسید دارند
4. **کل پرداختی‌ها**: مجموع مبالغ پرداخت شده

### نمودارهای آماری

#### نمودار دایره‌ای وضعیت پرداخت‌ها
نمایش درصد اقساط:
- پرداخت شده (سبز)
- در انتظار (نارنجی)
- معوق (قرمز)

#### نمودار میله‌ای پرداخت‌های ماهانه
نمایش مبلغ پرداخت‌های 6 ماه اخیر

### فعالیت‌های اخیر

لیست 5 پرداخت اخیر با جزئیات:
- شماره بیمه‌نامه
- شماره قسط
- مبلغ
- تاریخ پرداخت (شمسی)

---

## 4. مدیریت بیمه‌نامه‌ها {#policies}

### افزودن بیمه‌نامه جدید

1. از تب "بیمه‌نامه‌ها"، روی "+ بیمه‌نامه جدید" کلیک کنید
2. فرم را پر کنید:
   - **شماره بیمه‌نامه**: شماره یکتای بیمه‌نامه (الزامی)
   - **نام بیمه‌گذار**: نام و نام خانوادگی بیمه‌گذار (الزامی)
   - **کد ملی**: کد ملی بیمه‌گذار (اختیاری)
   - **نوع بیمه**: عمر، درمان، اتومبیل، آتش‌سوزی، سایر
   - **شرکت بیمه**: نام شرکت بیمه‌گر (اختیاری)
   - **مبلغ کل**: کل مبلغ بیمه‌نامه به ریال (الزامی)
   - **تاریخ شروع**: تاریخ شروع قرارداد (الزامی)
   - **تاریخ پایان**: تاریخ پایان قرارداد (الزامی)
   - **توضیحات**: توضیحات اضافی (اختیاری)
3. روی "ذخیره" کلیک کنید

### جستجو در بیمه‌نامه‌ها

از کادر جستجو برای یافتن سریع بیمه‌نامه‌ها استفاده کنید:
- جستجو بر اساس شماره بیمه‌نامه
- جستجو بر اساس نام بیمه‌گذار
- جستجو بر اساس نوع بیمه

### مشاهده جزئیات

روی دکمه "مشاهده" در هر ردیف کلیک کنید تا جزئیات کامل بیمه‌نامه نمایش داده شود.

---

## 5. مدیریت اقساط {#installments}

### ایجاد اقساط برای بیمه‌نامه

اقساط می‌توانند به دو روش ایجاد شوند:

#### روش 1: ایجاد خودکار (توصیه می‌شود)
پس از ایجاد بیمه‌نامه، از بخش controllers می‌توانید اقساط را به صورت خودکار ایجاد کنید:

```python
# مثال در کد
inst_ctrl.create_installments_batch(
    policy_id=policy.id,
    total_amount=10000000,  # مبلغ کل
    num_installments=12,     # تعداد اقساط
    start_date=datetime.now(),  # تاریخ شروع
    interval_days=30         # فاصله بین اقساط (روز)
)
```

#### روش 2: ایجاد دستی
برای ایجاد قسط به صورت دستی، از متد create_installment استفاده کنید.

### ثبت پرداخت قسط

1. از تب "اقساط"، قسط مورد نظر را پیدا کنید
2. روی دکمه "ثبت پرداخت" کلیک کنید
3. اطلاعات پرداخت را تأیید کنید
4. یک اعلان دسکتاپ تأیید پرداخت نمایش داده می‌شود

### فیلتر اقساط

اقساط را بر اساس موارد زیر فیلتر کنید:
- وضعیت: در انتظار، پرداخت شده، معوق
- بازه زمانی
- بیمه‌نامه خاص

---

## 6. تقویم اقساط {#calendar}

تقویم نمایی بصری از اقساط را ارائه می‌دهد.

### ویژگی‌های تقویم

- **نمایش رنگی**: 
  - سبز: اقساط پرداخت شده
  - نارنجی: اقساط در انتظار
  - قرمز: اقساط معوق
  
- **انتخاب تاریخ**: با کلیک روی هر تاریخ، اقساط آن روز نمایش داده می‌شود

- **نمایش جزئیات**: برای هر قسط در تاریخ انتخابی:
  - شماره بیمه‌نامه
  - شماره قسط
  - مبلغ
  - وضعیت

---

## 7. گزارش‌گیری {#reports}

سیستم گزارش‌گیری پیشرفته با امکانات زیر:

### انواع گزارش

1. **گزارش اقساط**
   - لیست کامل اقساط با فیلترها
   - جزئیات پرداخت

2. **خلاصه بیمه‌نامه‌ها**
   - اطلاعات کلی بیمه‌نامه‌ها
   - آمار پرداخت‌ها

3. **آمار پرداخت‌ها**
   - پرداخت‌های ماهانه
   - روند پرداخت‌ها

### فیلترها

گزارش‌ها را با موارد زیر فیلتر کنید:
- **بازه زمانی**: از تاریخ - تا تاریخ
- **وضعیت**: همه، پرداخت شده، در انتظار، معوق
- **بیمه‌نامه خاص**: انتخاب بیمه‌نامه مشخص

### خروجی گزارش

دو فرمت خروجی:

1. **Excel (.xlsx)**
   - مناسب برای تحلیل پیشرفته
   - قابلیت ویرایش
   - نمودارهای خودکار

2. **CSV (.csv)**
   - فایل متنی با فاصله‌گذار کاما
   - قابل باز شدن در همه برنامه‌ها
   - مناسب برای پردازش خودکار

### نحوه خروجی گرفتن

1. نوع گزارش را انتخاب کنید
2. فیلترهای مورد نظر را اعمال کنید
3. روی "خروجی Excel" یا "خروجی CSV" کلیک کنید
4. محل ذخیره فایل را انتخاب کنید

---

## 8. سیستم پیامک {#sms}

### پیکربندی سرویس پیامک

قبل از استفاده، سرویس پیامک را پیکربندی کنید:

1. از تب "پیامک‌ها"، به بخش "پیکربندی سرویس پیامک" بروید
2. اطلاعات API را وارد کنید:
   - **API Key**: کلید دسترسی سرویس پیامک
   - **API URL**: آدرس وب سرویس پیامک
3. روی "ذخیره تنظیمات" کلیک کنید

یا از منوی "تنظیمات" > "تنظیمات پیامک" استفاده کنید.

### ارسال پیامک دستی

1. شماره تلفن گیرنده را وارد کنید (مثال: 09123456789)
2. متن پیام را بنویسید
3. روی "ارسال پیامک" کلیک کنید

### برنامه‌ریزی خودکار یادآورها

برای ایجاد خودکار یادآورها برای همه بیمه‌نامه‌های فعال:

1. روی دکمه "برنامه‌ریزی خودکار یادآورها" کلیک کنید
2. سیستم به طور خودکار:
   - برای هر قسط سررسید نشده یک یادآور ایجاد می‌کند
   - یادآور 3 روز قبل از سررسید برنامه‌ریزی می‌شود
   - اطلاعات بیمه‌نامه و قسط را در پیام قرار می‌دهد

### تاریخچه پیامک‌ها

جدول تاریخچه نمایش می‌دهد:
- نوع یادآور (sms, notification)
- عنوان
- تاریخ ارسال (شمسی)
- گیرنده
- وضعیت (ارسال شده، در انتظار، خطا)

---

## 9. تنظیمات {#settings}

### تنظیمات پیامک

از منوی "تنظیمات" > "تنظیمات پیامک" برای پیکربندی API.

### پروفایل کاربری

از منوی "تنظیمات" > "پروفایل کاربری" برای مشاهده:
- نام کاربری
- نام کامل
- ایمیل
- شماره تلفن

### تغییر رمز عبور

برای تغییر رمز عبور، از قابلیت change_password در AuthController استفاده کنید:

```python
auth_ctrl.change_password(user_id, old_password, new_password)
```

---

## 10. رفع مشکلات {#troubleshooting}

### مشکلات رایج

#### 1. برنامه اجرا نمی‌شود

**راه حل**:
```bash
# بررسی نسخه Python
python --version

# نصب مجدد وابستگی‌ها
pip install -r requirements.txt --force-reinstall
```

#### 2. خطای دیتابیس

**راه حل**:
```bash
# حذف دیتابیس و ایجاد مجدد
rm insurance.db
python main.py
```

#### 3. فونت فارسی به درستی نمایش داده نمی‌شود

**راه حل**:
- فونت Vazir را دانلود و نصب کنید
- یا از فونت پیش‌فرض Tahoma استفاده می‌شود

#### 4. اعلان‌های دسکتاپ کار نمی‌کند

**راه حل**:
- در Linux: نصب `libnotify-bin`
- در Windows: فعال‌سازی اعلان‌ها از تنظیمات سیستم

#### 5. خروجی Excel کار نمی‌کند

**راه حل**:
```bash
pip install openpyxl --upgrade
```

### بررسی لاگ‌ها

لاگ‌های برنامه در فایل `insurance_manager.log` ذخیره می‌شود.

برای مشاهده لاگ‌های اخیر:
```bash
# در Linux/Mac
tail -f insurance_manager.log

# در Windows
type insurance_manager.log
```

### پشتیبانی

برای کمک بیشتر:
- مشاهده مستندات کامل در README.md
- گزارش مشکلات در GitHub Issues
- بررسی لاگ‌های برنامه

---

## نکات امنیتی

⚠️ **نکات مهم**:
1. حتماً رمز عبور پیش‌فرض را تغییر دهید
2. از رمز عبور قوی استفاده کنید (حداقل 8 کاراکتر، ترکیبی از حروف و اعداد)
3. فایل دیتابیس (insurance.db) را به طور منظم پشتیبان بگیرید
4. کلیدهای API پیامک را محرمانه نگه دارید

---

**موفق باشید!**

برای سوالات بیشتر یا گزارش مشکل، لطفاً به مخزن GitHub مراجعه کنید:
https://github.com/mhmdhosn82/main
